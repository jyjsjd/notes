---
title: RabbitMQ运转流程
created: '2019-01-29T05:24:21.031Z'
modified: '2019-01-29T05:58:12.611Z'
tags: [Middleware]
---

# RabbitMQ运转流程

在最初状态下，**生产者**发送消息的时候：
1. 生产者连接到 `RabbitMQ Broker`，建立一个`连接`（Connection），开启一个`信道`（Channel）。
2. 生产者声明一个`交换器`（Exchange），并设置相关属性，比如交换机类型、是否持久化等。
3. 生产者声明一个`队列`（Queue）并设置相关属性，比如是否排他、是否持久化、是否自动删除等。
4. 生产者通过`路由键`（Routing Key）将交换器和队列绑定起来。
5. 生产者发送消息至 `RabbitMQ Broker`，其中包含`路由键`、`交换器`等信息。
6. 相应的`交换器`根据接收到的`路由键`查找相匹配的`队列`。
7. 如果找到，则将从生产者发送过来的消息存入相应的`队列`中。
8. 如果没有找到，则根据生产者配置的属性选择丢弃还是回退给生产者。
9. 关闭`信道`。
10. 关闭`连接`。

**消费者**接收消息的过程：
1. 消费者连接到 `RabbitMQ Broker`，建立一个`连接`（Connection），开启一个`信道`（Channel）。
2. 消费者向 `RabbitMQ Broker` 请求消费相应`队列`中的消息，可能会设置相应的回调函数，以及做一些准备工作。
3. 等待 `RabbitMQ Broker` 回应并投递相应`队列`中的消息，消费者接收消息。
4. 消费者`确认`（ack）接收到的消息。
5. RabbitMQ 从`队列`中删除相应已经被确认的消息。
6. 关闭`信道`。
7. 关闭`连接`。
